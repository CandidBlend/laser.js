/*! laser.js v0.0.1, 2013-07-19 */
(function(t,e){"use strict";function i(t){var e,i,s,n,o,r;return r=t.css(d("Transform").css),o=r.split("(")[1].split(")")[0].split(","),e=o[0],i=o[1],s=o[2],n=o[3],{scale:Math.sqrt(e*e+i*i),angle:Math.round(Math.atan2(i,e)*(180/Math.PI))}}function s(t){return E[t]}function n(t){return E[t]=s(t)||$(t),E[t]}function o(t){var e="000000";return(e+t).slice(-e.length)}function r(){return/(MSIE 9\.0)/.test(navigator.userAgent)?!1:!0}function a(t){return r()?$.cssEase[t]!==e?!0:!1:$.easing[t]!==e?!0:!1}function h(t){return $.cssEase[t]}function u(t,e){return""===e?t:"string"!=typeof t||/^[0-9]+$/.test(t)?""+t+e:t}function c(t,e){var i="<style> ."+t+" { "+e+"} </style>";return $("html > head").append(i),t}function m(){return _.uniqueId("laser_tr_")}function l(t){return t.replace(/-([a-z])/gi,function(t,e){return e.toUpperCase()})}function f(t){return t.charAt(0).toUpperCase()+t.slice(1)}function p(t){var e,i=l(t);return _.each(A,function(s){""===y[s+f(i)]&&(e={css:"-"+s.toLowerCase()+"-",om:s}),""===y[t.toLowerCase()]&&(e={css:"",om:""})}),e}function d(t){return{css:p(t).css+t.toLowerCase(),om:p(t).om+t}}function g(t,i,s){var n,o,r,a="",c="";return o=T(i),_.each(t,function(t,e){_.contains(C,e)?(n="perspective"===e?"px":"deg",n="scale"===e?"":n,""===r?r+=" "+e+"("+u(t,n)+") ":r=e+"("+u(t,n)+") "):(n="opacity"===e?"":"px",a+=d(e).css+" : "+u(t,n)+";")}),c+=d("transition-duration").css+": "+o+";",c+=d("transition-timing-function").css+":"+h(s)+";",r!==e&&(c+=d("Transform").css+":"+r+";"),c+=a}function T(t){return"string"!=typeof t||/^[0-9]+$/.test(t)?t/1e3+"s":t}var w=t.Laser=function w(e){return _.extend(this,e),this.listeners={},this.animations=[],this.direction="forward",this.transition=r(),this.DEBUG=this.DEBUG||!1,this.console="object"==typeof t.console,this},E={},v=document.createElement("div"),y=v.style,A=["","webkit","Moz","o","ms"];["webkitTransitionEnd","oTransitionEnd","otransitionend","transitionend","msTransitionEnd"].join(" ");var C=["matrix","matrix3d","translate","translate3d","translateX","translateY","translateZ","scale","scale3d","scaleX","scaleY","scaleZ","rotate","rotate3d","rotateX","rotateY","rotateZ","skew","skewX","skewY","perspective"];$.cssHooks.rotate={get:function(t){var e=i($(t));return"("+e.angle+"deg)"}},$.cssHooks.scale={get:function(t){return i($(t)).scale}};var b=function b(t){return _.extend(this,t),this.state="ON_STACK",this};b.prototype={getCurrentParams:function(){var t={};return _.forEach(this.params,function(e,i){t[i]=_.contains(C,i)?this.$elem.css(i):this.$elem.css(i)},this),t},play:function(){this.sequence.transition?this.transition():this.animate(),this.startParams=this.getCurrentParams(),this.state="PLAYING",this.active=!0},complete:function(){this.sequence.trigger("animation:completed",this),this.state="COMPLETED",this.active=!1},resume:function(){_.forEach(this.params,function(t,e){this.$elem.css(e,"")},this),this.$elem.attr("style",this.pausedTransition.style),this.completeTimeout=setTimeout(_.bind(function(){this.complete()},this),this.options.duration),this.state="PLAYING"},pause:function(){var t,e;t=d("Transform").css,e=this.$elem.css(t),this.pausedTransition={key:t,val:e,style:this.$elem.attr("style")},_.forEach(this.params,function(t,e){this.$elem.css(e,this.$elem.css(e))},this),this.state="PAUSED"},rewind:function(){this.$elem.removeClass(this.id),this.completeTimeout=setTimeout(_.bind(function(){this.complete()},this),this.options.duration)},animate:function(){return this.$elem,delete this.options.when,this.options.queue=!1,this.options.complete=this.complete,this.$elem.animate(this.params,this.options)},transition:function(){var t=g(this.params,this.options.duration,this.options.easing);c(this.id,t),this.$elem.addClass(this.id),this.completeTimeout=setTimeout(_.bind(function(){this.complete()},this),this.options.duration)}},w.prototype={elapsed:function(){return(new Date).getTime()-this.startedAt},log:function(t){if(this.console&&this.DEBUG){var e=Array.prototype.slice.call(arguments);e[0]="DEBUG ["+o(this.elapsed())+"] > "+t,console.log.apply(console,e)}},get:function(t,i){return i===e?this[t]:_.where(this[t],i)},set:function(t,i,s){var n=this.get(t,i);return n===e?e:(_.forEach(s,function(t,e){result[e]=t},this),obj)},on:function(t,e){return this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e),this},off:function(t,e){return this.listeners[t]&&this.listeners[t].splice(this.listeners[t].indexOf(e),1),this},trigger:function(t){if(this.listeners[t]){var e=Array.prototype.slice.call(arguments,1);_.forEach(this.listeners[t],function(t){t.apply(this,e)},this)}return this},add:function(t,e,i){var s,o=this,r=n(t);if(s=i.when||0,i.easing=i.easing||"easeOutExpo",!a(i.easing)){if(!a("easeOutExpo"))throw Error("Unknown easing method! - "+i.easing);i.easing="easeOutExpo"}return i.duration=i.duration||500,this.animations.push(new b({id:m(),when:s,active:!1,params:e,options:i,sequence:o,$elem:r})),this},addEasing:function(t,e){return"string"==typeof e?$.cssEase[t]=e:$.easing[t]=e,this},onAnimated:function(){this.padTime?setTimeout(_.bind(function(){this.trigger("sequence:completed")},this),this.padTime):(this.log("sequence completed"),this.trigger("sequence:completed"))},onAnimationComplete:function(){this.remaining--,0===this.remaining&&this.trigger("sequence:animated")},start:function(){var t=this.get("animations");return this.startedAt=(new Date).getTime(),this.remaining=t.length,this.trigger("sequence:started",this.remaining),this.log("starting sequence"),_.forEach(t,function(t){t.whenTimeout=setTimeout(_.bind(function(){t.play()},this),t.when)},this),this.on("sequence:animated",function(){this.onAnimated()}),this.on("animation:completed",function(t){this.onAnimationComplete(t)}),this},wait:function(t){this.padTime=t},pause:function(){return this.pausedAt=this.elapsed(),this.log("pausing"),_.forEach(this.get("animations"),function(t){switch(t.state){case"STOPPED":break;case"ON_STACK":t.state="ON_STACK_RESET",clearTimeout(t.whenTimeout);break;case"PLAYING":clearTimeout(t.completeTimeout),t.pause()}},this),this},resume:function(){var t=this.pausedAt;return this.log("resuming"),_.forEach(this.get("animations"),function(e){switch(e.state){case"PAUSED":e.resume();break;case"ON_STACK_RESET":e.whenTimeout=setTimeout(_.bind(function(){e.play()},this),e.when-t),this.state="ON_STACK"}},this),this},rewind:function(){var t,e,i;return i=this.pausedAt,t=this.getRunTime(),this.log("reverse"),e=_.map(this.get("animations"),function(e){return e.when=t-e.when-e.options.duration,e},this),e.reverse(),_.forEach(e,function(t){t.whenTimeout=setTimeout(_.bind(function(){t.rewind()},this),t.when)},this),this.direction="rewind",this.remaining=e.length,this},getRunTime:function(){var t,e=this.get("animations");return t=e[e.length-1],t.when+t.options.duration}}})(window);